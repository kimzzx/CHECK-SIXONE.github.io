<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CHECK SIXONE - ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;family=Noto+Sans+Thai:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Inter', 'Noto Sans Thai', sans-serif;
    }
    
    * {
      box-sizing: border-box;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
      max-width: 90%;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 999;
      padding: 20px;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      max-width: 500px;
      width: 100%;
      max-height: 90%;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    .btn-status {
      transition: all 0.2s ease;
      position: relative;
    }

    .btn-status:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .btn-status:active {
      transform: translateY(0);
    }

    .btn-status.active::after {
      content: '‚úì';
      position: absolute;
      top: -4px;
      right: -4px;
      background: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .student-row {
      transition: background-color 0.2s ease;
    }

    .student-row:hover {
      background-color: #f9fafb;
    }

    @media (max-width: 640px) {
      .toast {
        left: 20px;
        right: 20px;
        max-width: none;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="bg-gray-50">
  <div id="app"></div>
  <script>
    const defaultConfig = {
      background_color: '#f9fafb',
      surface_color: '#ffffff',
      text_color: '#1f2937',
      primary_color: '#14532d',
      secondary_color: '#16a34a',
      font_family: 'Inter',
      font_size: 16,
      app_title: 'CHECK SIXONE',
      tagline: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ß ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏µ‡∏¢‡∏ß',
      cta_button: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
      menu_check: '‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ',
      menu_students: '‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô',
      menu_report: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
      menu_settings: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',
      menu_about: '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö'
    };

    // No reference students - all students are user-generated (Paradigm B)
    const referenceStudents = [];

    let currentPage = 'home';
    let attendanceRecords = [];
    let studentRecords = [];
    let searchQuery = '';
    let filterClass = 'all';
    let isLoading = false;
    let editingStudent = null;
    let showEditModal = false;
    let showAddModal = false;
    let deletingStudentId = null;

    const dataHandler = {
      onDataChanged(data) {
        attendanceRecords = data.filter(r => r.date);
        studentRecords = data.filter(r => r.student_number);
        render();
      }
    };

    async function initApp() {
      const initResult = await window.dataSdk.init(dataHandler);
      if (!initResult.isOk) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ', 'error');
        return;
      }
      render();
    }

    function getStudentList() {
      // Merge reference students with custom student records
      const customStudents = studentRecords.map(s => ({
        id: s.student_id,
        name: s.student_name,
        class: s.student_class,
        isCustom: true,
        recordId: s.__backendId
      }));

      const referenceStudentIds = referenceStudents.map(s => s.id);
      const customStudentIds = customStudents.map(s => s.id);

      // Override reference students with custom data if exists
      const mergedStudents = referenceStudents.map(refStudent => {
        const customStudent = customStudents.find(cs => cs.id === refStudent.id);
        return customStudent || { ...refStudent, isCustom: false };
      });

      // Add custom students that don't exist in reference
      customStudents.forEach(cs => {
        if (!referenceStudentIds.includes(cs.id)) {
          mergedStudents.push(cs);
        }
      });

      return mergedStudents.sort((a, b) => {
        const numA = parseInt(a.id) || 0;
        const numB = parseInt(b.id) || 0;
        return numA - numB;
      });
    }

    function getTodayString() {
      const today = new Date();
      const year = today.getFullYear();
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const day = String(today.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function getStudentStatus(studentId, date) {
      const record = attendanceRecords.find(r => 
        r.student_id === studentId && r.date === date
      );
      return record ? record.status : null;
    }

    async function setAttendance(studentId, status) {
      if (attendanceRecords.length >= 999) {
        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'error');
        return;
      }

      isLoading = true;
      render();

      const today = getTodayString();
      const existingRecord = attendanceRecords.find(r => 
        r.student_id === studentId && r.date === today
      );

      if (existingRecord) {
        existingRecord.status = status;
        existingRecord.timestamp = Date.now();
        const result = await window.dataSdk.update(existingRecord);
        
        if (result.isOk) {
          showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        }
      } else {
        const newRecord = {
          date: today,
          student_id: studentId,
          status: status,
          remark: '',
          timestamp: Date.now()
        };
        
        const result = await window.dataSdk.create(newRecord);
        
        if (result.isOk) {
          showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        }
      }

      isLoading = false;
      render();
    }

    async function markAllPresent() {
      const students = getStudentList();
      if (attendanceRecords.length + students.length > 999) {
        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'error');
        return;
      }

      isLoading = true;
      render();

      const today = getTodayString();
      
      for (const student of students) {
        const existingRecord = attendanceRecords.find(r => 
          r.student_id === student.id && r.date === today
        );

        if (existingRecord) {
          existingRecord.status = '‡∏°‡∏≤';
          existingRecord.timestamp = Date.now();
          await window.dataSdk.update(existingRecord);
        } else {
          const newRecord = {
            date: today,
            student_id: student.id,
            status: '‡∏°‡∏≤',
            remark: '',
            timestamp: Date.now()
          };
          await window.dataSdk.create(newRecord);
        }
      }

      isLoading = false;
      showToast('‡∏ï‡∏¥‡πä‡∏Å‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      render();
    }

    function getTodaySummary() {
      const today = getTodayString();
      const todayRecords = attendanceRecords.filter(r => r.date === today);
      const students = getStudentList();
      
      return {
        present: todayRecords.filter(r => r.status === '‡∏°‡∏≤').length,
        absent: todayRecords.filter(r => r.status === '‡∏Ç‡∏≤‡∏î').length,
        leave: todayRecords.filter(r => r.status === '‡∏•‡∏≤').length,
        total: students.length
      };
    }

    function showToast(message, type = 'success') {
      const existingToast = document.querySelector('.toast');
      if (existingToast) {
        existingToast.remove();
      }

      const toast = document.createElement('div');
      toast.className = `toast ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    function generateSummaryText() {
      const today = getTodayString();
      const todayRecords = attendanceRecords.filter(r => r.date === today);
      const students = getStudentList();
      const summary = getTodaySummary();
      
      // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
      const dateObj = new Date(today);
      const thaiDate = dateObj.toLocaleDateString('th-TH', { 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric',
        weekday: 'long'
      });
      
      let text = `üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠\n`;
      text += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${thaiDate}\n`;
      text += `‡∏´‡πâ‡∏≠‡∏á: 6/1\n\n`;
      
      text += `‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:\n`;
      text += `‚úÖ ‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${summary.present} ‡∏Ñ‡∏ô\n`;
      text += `‚ùå ‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: ${summary.absent} ‡∏Ñ‡∏ô\n`;
      text += `üìù ‡∏•‡∏≤: ${summary.leave} ‡∏Ñ‡∏ô\n`;
      text += `üë• ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${summary.total} ‡∏Ñ‡∏ô\n\n`;
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î
      if (summary.absent > 0) {
        text += `‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:\n`;
        students.forEach(student => {
          const record = todayRecords.find(r => r.student_id === student.id);
          if (record && record.status === '‡∏Ç‡∏≤‡∏î') {
            text += `  - ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.id} ${student.name}\n`;
          }
        });
        text += `\n`;
      }
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤
      if (summary.leave > 0) {
        text += `‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤:\n`;
        students.forEach(student => {
          const record = todayRecords.find(r => r.student_id === student.id);
          if (record && record.status === '‡∏•‡∏≤') {
            text += `  - ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ${student.id} ${student.name}\n`;
          }
        });
        text += `\n`;
      }
      
      text += `---\n`;
      text += `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ CHECK SIXONE`;
      
      return text;
    }

    function copySummary() {
      const summaryText = generateSummaryText();
      
      // ‡πÉ‡∏ä‡πâ Clipboard API
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(summaryText)
          .then(() => {
            showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
          })
          .catch(() => {
            // Fallback method
            fallbackCopy(summaryText);
          });
      } else {
        // Fallback method for older browsers
        fallbackCopy(summaryText);
      }
    }

    function fallbackCopy(text) {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.left = '-999999px';
      document.body.appendChild(textArea);
      textArea.select();
      
      try {
        document.execCommand('copy');
        showToast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
      } catch (err) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
      }
      
      document.body.removeChild(textArea);
    }

    function exportCSV() {
      const today = getTodayString();
      const todayRecords = attendanceRecords.filter(r => r.date === today);
      
      if (todayRecords.length === 0) {
        showToast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ', 'error');
        return;
      }

      const students = getStudentList();
      
      let csv = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà,‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà,‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•,‡∏´‡πâ‡∏≠‡∏á,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞,‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏\n';
      
      students.forEach(student => {
        const record = todayRecords.find(r => r.student_id === student.id);
        const status = record ? record.status : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡πá‡∏Ñ';
        const remark = record ? record.remark : '';
        csv += `${today},${student.id},${student.name},${student.class},${status},${remark}\n`;
      });

      const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = `‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠_${today}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(link.href);
      
      showToast(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${todayRecords.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`, 'success');
    }

    function getFilteredStudents() {
      const students = getStudentList();
      return students.filter(student => {
        const matchesSearch = student.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                            student.id.includes(searchQuery);
        const matchesClass = filterClass === 'all' || student.class === filterClass;
        return matchesSearch && matchesClass;
      });
    }

    function openEditModal(studentId) {
      const students = getStudentList();
      const student = students.find(s => s.id === studentId);
      if (student) {
        editingStudent = { ...student };
        showEditModal = true;
        render();
      }
    }

    function closeEditModal() {
      editingStudent = null;
      showEditModal = false;
      render();
    }

    function openAddModal() {
      showAddModal = true;
      render();
    }

    function closeAddModal() {
      showAddModal = false;
      render();
    }

    function confirmDeleteStudent(studentId, recordId) {
      deletingStudentId = { id: studentId, recordId: recordId };
      render();
    }

    function cancelDelete() {
      deletingStudentId = null;
      render();
    }

    async function deleteStudent() {
      if (!deletingStudentId) return;

      isLoading = true;
      render();

      const record = studentRecords.find(r => r.student_id === deletingStudentId.id);
      if (record && record.__backendId) {
        const result = await window.dataSdk.delete(record);
        if (result.isOk) {
          showToast('‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
          deletingStudentId = null;
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
        }
      } else {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÑ‡∏î‡πâ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ó‡∏ô‡πÑ‡∏î‡πâ', 'error');
        deletingStudentId = null;
      }

      isLoading = false;
      render();
    }

    async function saveStudent(event) {
      event.preventDefault();
      
      if (studentRecords.length >= 999 && !editingStudent.isCustom) {
        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß', 'error');
        return;
      }

      isLoading = true;
      render();

      const formData = new FormData(event.target);
      const newNumber = formData.get('student_number');
      const newName = formData.get('student_name');
      const newClass = formData.get('student_class');

      // Check if student number already exists (excluding current student)
      const students = getStudentList();
      const duplicate = students.find(s => s.id === newNumber && s.id !== editingStudent.id);
      if (duplicate) {
        showToast('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô', 'error');
        isLoading = false;
        render();
        return;
      }

      if (editingStudent.isCustom && editingStudent.recordId) {
        // Update existing custom student
        const existingRecord = studentRecords.find(r => r.__backendId === editingStudent.recordId);
        if (existingRecord) {
          existingRecord.student_id = newNumber;
          existingRecord.student_number = newNumber;
          existingRecord.student_name = newName;
          existingRecord.student_class = newClass;
          existingRecord.timestamp = Date.now();
          
          const result = await window.dataSdk.update(existingRecord);
          if (result.isOk) {
            showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            closeEditModal();
          } else {
            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'error');
          }
        }
      } else {
        // Create new custom student record (override reference student)
        const newRecord = {
          student_id: newNumber,
          student_number: newNumber,
          student_name: newName,
          student_class: newClass,
          timestamp: Date.now()
        };
        
        const result = await window.dataSdk.create(newRecord);
        if (result.isOk) {
          showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
          closeEditModal();
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', 'error');
        }
      }

      isLoading = false;
      render();
    }

    async function addNewStudent(event) {
      event.preventDefault();
      
      if (studentRecords.length >= 999) {
        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß', 'error');
        return;
      }

      isLoading = true;
      render();

      const formData = new FormData(event.target);
      const newNumber = formData.get('student_number');
      const newName = formData.get('student_name');
      const newClass = formData.get('student_class');

      // Check if student number already exists
      const students = getStudentList();
      const duplicate = students.find(s => s.id === newNumber);
      if (duplicate) {
        showToast('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô', 'error');
        isLoading = false;
        render();
        return;
      }

      const newRecord = {
        student_id: newNumber,
        student_number: newNumber,
        student_name: newName,
        student_class: newClass,
        timestamp: Date.now()
      };
      
      const result = await window.dataSdk.create(newRecord);
      if (result.isOk) {
        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
        closeAddModal();
      } else {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°', 'error');
      }

      isLoading = false;
      render();
    }

    async function onConfigChange(config) {
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Inter, Noto Sans Thai, sans-serif';
      const baseSize = config.font_size || defaultConfig.font_size;

      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
      document.body.style.color = config.text_color || defaultConfig.text_color;

      const appTitle = document.getElementById('app-title');
      if (appTitle) {
        appTitle.textContent = config.app_title || defaultConfig.app_title;
        appTitle.style.fontSize = `${baseSize * 1.5}px`;
        appTitle.style.color = config.primary_color || defaultConfig.primary_color;
      }

      const tagline = document.getElementById('tagline');
      if (tagline) {
        tagline.textContent = config.tagline || defaultConfig.tagline;
        tagline.style.fontSize = `${baseSize}px`;
        tagline.style.color = config.text_color || defaultConfig.text_color;
      }

      const ctaButton = document.getElementById('cta-button');
      if (ctaButton) {
        ctaButton.textContent = config.cta_button || defaultConfig.cta_button;
        ctaButton.style.backgroundColor = config.primary_color || defaultConfig.primary_color;
        ctaButton.style.fontSize = `${baseSize}px`;
      }

      const menuItems = ['check', 'students', 'report', 'settings', 'about'];
      menuItems.forEach(item => {
        const menuEl = document.getElementById(`menu-${item}`);
        if (menuEl) {
          menuEl.textContent = config[`menu_${item}`] || defaultConfig[`menu_${item}`];
          menuEl.style.fontSize = `${baseSize * 0.875}px`;
        }
      });

      const surfaces = document.querySelectorAll('.surface');
      surfaces.forEach(surface => {
        surface.style.backgroundColor = config.surface_color || defaultConfig.surface_color;
      });

      const primaryButtons = document.querySelectorAll('.btn-primary');
      primaryButtons.forEach(btn => {
        btn.style.backgroundColor = config.primary_color || defaultConfig.primary_color;
        btn.style.fontSize = `${baseSize * 0.875}px`;
      });

      const secondaryButtons = document.querySelectorAll('.btn-secondary');
      secondaryButtons.forEach(btn => {
        btn.style.backgroundColor = config.secondary_color || defaultConfig.secondary_color;
        btn.style.fontSize = `${baseSize * 0.875}px`;
      });

      const textElements = document.querySelectorAll('.text-content');
      textElements.forEach(el => {
        el.style.color = config.text_color || defaultConfig.text_color;
        el.style.fontSize = `${baseSize}px`;
      });
    }

    function render() {
      const config = window.elementSdk?.config || defaultConfig;
      const app = document.getElementById('app');
      
      if (currentPage === 'home') {
        app.innerHTML = renderHomePage(config);
      } else if (currentPage === 'check') {
        app.innerHTML = renderCheckPage(config);
      } else if (currentPage === 'students') {
        app.innerHTML = renderStudentsPage(config);
      } else if (currentPage === 'report') {
        app.innerHTML = renderReportPage(config);
      } else if (currentPage === 'settings') {
        app.innerHTML = renderSettingsPage(config);
      } else if (currentPage === 'about') {
        app.innerHTML = renderAboutPage(config);
      }

      if (showEditModal) {
        app.innerHTML += renderEditModal(config);
      }

      if (showAddModal) {
        app.innerHTML += renderAddModal(config);
      }

      if (deletingStudentId) {
        app.innerHTML += renderDeleteConfirmation(config);
      }

      attachEventListeners();
      onConfigChange(config);
    }

    function renderEditModal(config) {
      if (!editingStudent) return '';
      
      return `
        <div class="modal-overlay" onclick="handleEditModalClick(event)">
          <div class="modal-content" onclick="event.stopPropagation()">
            <div class="p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h3>
                <button onclick="closeEditModal()" class="text-2xl text-content hover:opacity-70" style="color: ${config.text_color || defaultConfig.text_color}">&times;</button>
              </div>
              
              <form onsubmit="saveStudent(event)" class="space-y-4">
                <div>
                  <label for="student_number" class="block text-sm font-medium text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                  <input 
                    type="text" 
                    id="student_number" 
                    name="student_number" 
                    value="${editingStudent.id}"
                    required
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  />
                </div>
                
                <div>
                  <label for="student_name" class="block text-sm font-medium text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                  <input 
                    type="text" 
                    id="student_name" 
                    name="student_name" 
                    value="${editingStudent.name}"
                    required
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  />
                </div>
                
                <div>
                  <label for="student_class" class="block text-sm font-medium text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡∏´‡πâ‡∏≠‡∏á</label>
                  <input 
                    type="text" 
                    id="student_class" 
                    name="student_class" 
                    value="${editingStudent.class}"
                    required
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  />
                </div>
                
                <div class="flex gap-3 pt-4">
                  <button 
                    type="submit" 
                    class="flex-1 btn-primary px-6 py-3 rounded-lg text-white font-medium"
                    style="background-color: ${config.primary_color || defaultConfig.primary_color}"
                    ${isLoading ? 'disabled' : ''}
                  >
                    ${isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å'}
                  </button>
                  <button 
                    type="button" 
                    onclick="closeEditModal()" 
                    class="flex-1 px-6 py-3 rounded-lg font-medium border"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.primary_color || defaultConfig.primary_color}"
                    ${isLoading ? 'disabled' : ''}
                  >
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderAddModal(config) {
      return `
        <div class="modal-overlay" onclick="handleAddModalClick(event)">
          <div class="modal-content" onclick="event.stopPropagation()">
            <div class="p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
                <button onclick="closeAddModal()" class="text-2xl text-content hover:opacity-70" style="color: ${config.text_color || defaultConfig.text_color}">&times;</button>
              </div>
              
              <form onsubmit="addNewStudent(event)" class="space-y-4">
                <div>
                  <label for="new_student_number" class="block text-sm font-medium text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</label>
                  <input 
                    type="text" 
                    id="new_student_number" 
                    name="student_number" 
                    required
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 11"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  />
                </div>
                
                <div>
                  <label for="new_student_name" class="block text-sm font-medium text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
                  <input 
                    type="text" 
                    id="new_student_name" 
                    name="student_name" 
                    required
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏î.‡∏ä. ‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  />
                </div>
                
                <div>
                  <label for="new_student_class" class="block text-sm font-medium text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡∏´‡πâ‡∏≠‡∏á</label>
                  <input 
                    type="text" 
                    id="new_student_class" 
                    name="student_class" 
                    required
                    placeholder="‡πÄ‡∏ä‡πà‡∏ô 6/1"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  />
                </div>
                
                <div class="flex gap-3 pt-4">
                  <button 
                    type="submit" 
                    class="flex-1 btn-primary px-6 py-3 rounded-lg text-white font-medium"
                    style="background-color: ${config.primary_color || defaultConfig.primary_color}"
                    ${isLoading ? 'disabled' : ''}
                  >
                    ${isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°...' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô'}
                  </button>
                  <button 
                    type="button" 
                    onclick="closeAddModal()" 
                    class="flex-1 px-6 py-3 rounded-lg font-medium border"
                    style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.primary_color || defaultConfig.primary_color}"
                    ${isLoading ? 'disabled' : ''}
                  >
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
    }

    function renderDeleteConfirmation(config) {
      const students = getStudentList();
      const student = students.find(s => s.id === deletingStudentId.id);
      
      return `
        <div class="modal-overlay" onclick="event.stopPropagation()">
          <div class="modal-content" style="max-width: 400px" onclick="event.stopPropagation()">
            <div class="p-6">
              <div class="text-center mb-6">
                <div class="text-5xl mb-4">‚ö†Ô∏è</div>
                <h3 class="text-xl font-bold text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
                <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">
                  ‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô<br/>
                  <strong>${student ? student.name : ''}</strong><br/>
                  ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?
                </p>
              </div>
              
              <div class="flex gap-3">
                <button 
                  onclick="deleteStudent()" 
                  class="flex-1 px-6 py-3 rounded-lg text-white font-medium bg-red-600 hover:bg-red-700"
                  ${isLoading ? 'disabled' : ''}
                >
                  ${isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...' : '‡∏•‡∏ö'}
                </button>
                <button 
                  onclick="cancelDelete()" 
                  class="flex-1 px-6 py-3 rounded-lg font-medium border"
                  style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.primary_color || defaultConfig.primary_color}"
                  ${isLoading ? 'disabled' : ''}
                >
                  ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderHomePage(config) {
      const summary = getTodaySummary();
      
      return `
        <div class="min-h-full" style="background-color: ${config.background_color || defaultConfig.background_color}">
          ${renderHeader(config)}
          
          <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
              <h1 id="app-title" class="text-4xl font-bold mb-4" style="color: ${config.primary_color || defaultConfig.primary_color}">${config.app_title || defaultConfig.app_title}</h1>
              <p id="tagline" class="text-xl text-content" style="color: ${config.text_color || defaultConfig.text_color}">${config.tagline || defaultConfig.tagline}</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    <p class="text-3xl font-bold" style="color: ${config.secondary_color || defaultConfig.secondary_color}">${summary.present}</p>
                  </div>
                  <div class="text-4xl">‚úì</div>
                </div>
              </div>

              <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    <p class="text-3xl font-bold text-red-600">${summary.absent}</p>
                  </div>
                  <div class="text-4xl">‚úó</div>
                </div>
              </div>

              <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
                <div class="flex items-center justify-between">
                  <div>
                    <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡∏•‡∏≤</p>
                    <p class="text-3xl font-bold text-yellow-600">${summary.leave}</p>
                  </div>
                  <div class="text-4xl">üìù</div>
                </div>
              </div>
            </div>

            <div class="text-center">
              <button id="cta-button" class="btn-primary px-8 py-4 rounded-lg text-white font-semibold shadow-lg hover:shadow-xl transition-all" style="background-color: ${config.primary_color || defaultConfig.primary_color}" onclick="navigateTo('check')">${config.cta_button || defaultConfig.cta_button}</button>
            </div>
          </main>
        </div>
      `;
    }

    function renderCheckPage(config) {
      const today = getTodayString();
      const summary = getTodaySummary();
      const filteredStudents = getFilteredStudents();
      
      return `
        <div class="min-h-full" style="background-color: ${config.background_color || defaultConfig.background_color}">
          ${renderHeader(config)}
          
          <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="mb-6">
              <h2 class="text-2xl font-bold text-content mb-2" style="color: ${config.text_color || defaultConfig.text_color}">‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
              <p class="text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">${today}</p>
            </div>

            <div class="surface p-4 rounded-lg shadow-md mb-6" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex gap-4 text-sm">
                  <span class="text-content">‡∏°‡∏≤: <strong style="color: ${config.secondary_color || defaultConfig.secondary_color}">${summary.present}</strong></span>
                  <span class="text-content">‡∏Ç‡∏≤‡∏î: <strong class="text-red-600">${summary.absent}</strong></span>
                  <span class="text-content">‡∏•‡∏≤: <strong class="text-yellow-600">${summary.leave}</strong></span>
                </div>
                <button class="btn-secondary px-4 py-2 rounded-lg text-white font-medium text-sm" style="background-color: ${config.secondary_color || defaultConfig.secondary_color}" onclick="markAllPresent()" ${isLoading ? 'disabled' : ''}>
                  ${isLoading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡πâ‡∏≠‡∏á'}
                </button>
              </div>
            </div>

            <div class="surface p-4 rounded-lg shadow-md mb-6" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <div class="flex flex-col sm:flex-row gap-4">
                <input 
                  type="text" 
                  id="search-input"
                  placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà..." 
                  class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                  style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  value="${searchQuery}"
                  oninput="handleSearch(event)"
                />
                <select 
                  id="class-filter"
                  class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2"
                  style="border-color: ${config.primary_color || defaultConfig.primary_color}; color: ${config.text_color || defaultConfig.text_color}"
                  onchange="handleFilterChange(event)"
                >
                  <option value="all">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
                  <option value="6/1" ${filterClass === '6/1' ? 'selected' : ''}>6/1</option>
                  <option value="6/2" ${filterClass === '6/2' ? 'selected' : ''}>6/2</option>
                </select>
              </div>
            </div>

            <div class="surface rounded-lg shadow-md overflow-hidden" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              ${filteredStudents.map(student => {
                const status = getStudentStatus(student.id, today);
                return `
                  <div class="student-row p-4 border-b last:border-b-0" style="border-color: rgba(0,0,0,0.1)">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                      <div class="flex-1">
                        <div class="flex items-center gap-3">
                          <span class="font-bold text-lg" style="color: ${config.primary_color || defaultConfig.primary_color}">${student.id}</span>
                          <h3 class="font-semibold text-content" style="color: ${config.text_color || defaultConfig.text_color}">${student.name}</h3>
                        </div>
                        <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6">${student.class}</p>
                      </div>
                      <div class="flex gap-2">
                        <button 
                          class="btn-status ${status === '‡∏°‡∏≤' ? 'active' : ''} px-4 py-2 rounded-lg font-medium text-sm text-white"
                          style="background-color: ${status === '‡∏°‡∏≤' ? config.secondary_color || defaultConfig.secondary_color : '#9ca3af'}"
                          onclick="setAttendance('${student.id}', '‡∏°‡∏≤')"
                          aria-label="‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏°‡∏≤"
                          ${isLoading ? 'disabled' : ''}
                        >
                          ‡∏°‡∏≤
                        </button>
                        <button 
                          class="btn-status ${status === '‡∏Ç‡∏≤‡∏î' ? 'active' : ''} px-4 py-2 rounded-lg font-medium text-sm text-white"
                          style="background-color: ${status === '‡∏Ç‡∏≤‡∏î' ? '#dc2626' : '#9ca3af'}"
                          onclick="setAttendance('${student.id}', '‡∏Ç‡∏≤‡∏î')"
                          aria-label="‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≤‡∏î"
                          ${isLoading ? 'disabled' : ''}
                        >
                          ‡∏Ç‡∏≤‡∏î
                        </button>
                        <button 
                          class="btn-status ${status === '‡∏•‡∏≤' ? 'active' : ''} px-4 py-2 rounded-lg font-medium text-sm text-white"
                          style="background-color: ${status === '‡∏•‡∏≤' ? '#ca8a04' : '#9ca3af'}"
                          onclick="setAttendance('${student.id}', '‡∏•‡∏≤')"
                          aria-label="‡∏ï‡∏¥‡πä‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡∏≤"
                          ${isLoading ? 'disabled' : ''}
                        >
                          ‡∏•‡∏≤
                        </button>
                      </div>
                    </div>
                  </div>
                `;
              }).join('')}
            </div>
          </main>
        </div>
      `;
    }

    function renderStudentsPage(config) {
      const students = getStudentList();
      
      return `
        <div class="min-h-full" style="background-color: ${config.background_color || defaultConfig.background_color}">
          ${renderHeader(config)}
          
          <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-2xl font-bold text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h2>
              <button 
                onclick="openAddModal()"
                class="btn-primary px-6 py-2 rounded-lg text-white font-medium"
                style="background-color: ${config.primary_color || defaultConfig.primary_color}"
              >
                + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
              </button>
            </div>

            <div class="surface rounded-lg shadow-md overflow-hidden" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <table class="w-full">
                <thead style="background-color: ${config.primary_color || defaultConfig.primary_color}">
                  <tr>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-white">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-white">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-white">‡∏´‡πâ‡∏≠‡∏á</th>
                    <th class="px-6 py-3 text-center text-sm font-semibold text-white">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                  </tr>
                </thead>
                <tbody>
                  ${students.map((student, index) => `
                    <tr class="border-b hover:bg-gray-50" style="border-color: rgba(0,0,0,0.1)">
                      <td class="px-6 py-4 text-sm font-medium text-content" style="color: ${config.text_color || defaultConfig.text_color}">${student.id}</td>
                      <td class="px-6 py-4 text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}">${student.name}</td>
                      <td class="px-6 py-4 text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}">${student.class}</td>
                      <td class="px-6 py-4 text-center">
                        <div class="flex gap-2 justify-center">
                          <button 
                            onclick="openEditModal('${student.id}')"
                            class="px-4 py-2 rounded text-white text-sm font-medium hover:opacity-90"
                            style="background-color: ${config.secondary_color || defaultConfig.secondary_color}"
                          >
                            ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                          </button>
                          <button 
                            onclick="confirmDeleteStudent('${student.id}', '${student.recordId || ''}')"
                            class="px-4 py-2 rounded text-white text-sm font-medium hover:opacity-90 bg-red-600"
                          >
                            ‡∏•‡∏ö
                          </button>
                        </div>
                      </td>
                    </tr>
                  `).join('')}
                </tbody>
              </table>
            </div>

            <div class="mt-6 text-center text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}">
              ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>${students.length}</strong> ‡∏Ñ‡∏ô
            </div>
          </main>
        </div>
      `;
    }

    function renderReportPage(config) {
      const summary = getTodaySummary();
      
      return `
        <div class="min-h-full" style="background-color: ${config.background_color || defaultConfig.background_color}">
          ${renderHeader(config)}
          
          <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <h2 class="text-2xl font-bold text-content mb-6" style="color: ${config.text_color || defaultConfig.text_color}">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
              <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
                <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏™‡∏£‡∏∏‡∏õ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                <div class="space-y-2">
                  <div class="flex justify-between">
                    <span class="text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡∏°‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                    <span class="font-bold" style="color: ${config.secondary_color || defaultConfig.secondary_color}">${summary.present}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡∏Ç‡∏≤‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                    <span class="font-bold text-red-600">${summary.absent}</span>
                  </div>
                  <div class="flex justify-between">
                    <span class="text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡∏•‡∏≤</span>
                    <span class="font-bold text-yellow-600">${summary.leave}</span>
                  </div>
                  <div class="flex justify-between pt-2 border-t" style="border-color: rgba(0,0,0,0.1)">
                    <span class="text-content font-semibold" style="color: ${config.text_color || defaultConfig.text_color}">‡∏£‡∏ß‡∏°</span>
                    <span class="font-bold text-content" style="color: ${config.text_color || defaultConfig.text_color}">${summary.total}</span>
                  </div>
                </div>
              </div>

              <div class="surface p-6 rounded-lg shadow-md md:col-span-2" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
                <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h3>
                <div class="flex items-end justify-around h-48 gap-2">
                  ${[1, 2, 3, 4, 5].map(day => {
                    const height = Math.random() * 80 + 20;
                    return `
                      <div class="flex-1 flex flex-col items-center gap-2">
                        <div class="w-full rounded-t" style="background-color: ${config.secondary_color || defaultConfig.secondary_color}; height: ${height}%"></div>
                        <span class="text-xs text-content" style="color: ${config.text_color || defaultConfig.text_color}">‡∏ß‡∏±‡∏ô ${day}</span>
                      </div>
                    `;
                  }).join('')}
                </div>
              </div>
            </div>

            <div class="surface p-6 rounded-lg shadow-md mb-6" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠</h3>
              <div class="p-4 rounded mb-4" style="background-color: ${config.background_color || defaultConfig.background_color}">
                <pre id="summary-text" class="text-sm text-content whitespace-pre-wrap" style="color: ${config.text_color || defaultConfig.text_color}">${generateSummaryText()}</pre>
              </div>
              <button class="btn-secondary px-6 py-3 rounded-lg text-white font-medium" style="background-color: ${config.secondary_color || defaultConfig.secondary_color}" onclick="copySummary()">
                üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•
              </button>
            </div>

            <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
              <p class="text-sm text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå CSV</p>
              <button class="btn-primary px-6 py-3 rounded-lg text-white font-medium" style="background-color: ${config.primary_color || defaultConfig.primary_color}" onclick="exportCSV()">
                ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å CSV
              </button>
            </div>
          </main>
        </div>
      `;
    }

    function renderSettingsPage(config) {
      const students = getStudentList();
      
      return `
        <div class="min-h-full" style="background-color: ${config.background_color || defaultConfig.background_color}">
          ${renderHeader(config)}
          
          <main class="max-w-7xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <h2 class="text-2xl font-bold text-content mb-6" style="color: ${config.text_color || defaultConfig.text_color}">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h2>

            <div class="surface p-6 rounded-lg shadow-md mb-6" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Canva Sheet</h3>
              <p class="text-sm text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ Canva Sheet ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
              </p>
              <div class="flex items-center gap-2 p-3 rounded" style="background-color: ${config.background_color || defaultConfig.background_color}">
                <span class="text-2xl">‚úì</span>
                <span class="text-sm font-medium text-content" style="color: ${config.secondary_color || defaultConfig.secondary_color}">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>
              </div>
            </div>

            <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
              <div class="space-y-3 text-sm">
                <div class="flex justify-between">
                  <span class="text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                  <span class="font-medium text-content" style="color: ${config.text_color || defaultConfig.text_color}">${attendanceRecords.length + studentRecords.length} / 999</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</span>
                  <span class="font-medium text-content" style="color: ${config.text_color || defaultConfig.text_color}">${students.length} ‡∏Ñ‡∏ô</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô</span>
                  <span class="font-medium text-content" style="color: ${config.text_color || defaultConfig.text_color}">1.1.0</span>
                </div>
              </div>
            </div>
          </main>
        </div>
      `;
    }

    function renderAboutPage(config) {
      return `
        <div class="min-h-full" style="background-color: ${config.background_color || defaultConfig.background_color}">
          ${renderHeader(config)}
          
          <main class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
            <h2 class="text-2xl font-bold text-content mb-6" style="color: ${config.text_color || defaultConfig.text_color}">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö</h2>

            <div class="surface p-6 rounded-lg shadow-md mb-6" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">CHECK SIXONE</h3>
              <p class="text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">
                ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏£‡∏π‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ä‡∏±‡πâ‡∏ô ‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
              </p>
              <div class="space-y-2 text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}">
                <p>‚úì ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏¥‡πä‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÜ</p>
                <p>‚úì ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ</p>
                <p>‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô Canva Sheet</p>
                <p>‚úì ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</p>
                <p>‚úì ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV</p>
                <p>‚úì ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï</p>
              </div>
            </div>

            <div class="surface p-6 rounded-lg shadow-md mb-6" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
              <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8">
                ‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà ‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• ‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô 
                ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Canva Sheet ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏ä‡∏£‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°
              </p>
            </div>

            <div class="surface p-6 rounded-lg shadow-md" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
              <h3 class="text-lg font-semibold text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</h3>
              <p class="text-sm text-content mb-4" style="color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8">
                ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
              </p>
              <p class="text-sm text-content" style="color: ${config.text_color || defaultConfig.text_color}">
                ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô: 1.1.0 | ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ Canva Code
              </p>
            </div>
          </main>
        </div>
      `;
    }

    function renderHeader(config) {
      return `
        <header class="surface shadow-sm" style="background-color: ${config.surface_color || defaultConfig.surface_color}">
          <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
              <div class="flex items-center gap-2">
                <div class="font-bold text-xl" style="color: ${config.primary_color || defaultConfig.primary_color}">CS6/1</div>
              </div>
              <div class="flex gap-1 sm:gap-4 text-sm">
                <button id="menu-check" class="px-2 sm:px-4 py-2 rounded hover:bg-gray-100 transition-colors ${currentPage === 'check' ? 'font-semibold' : ''}" style="color: ${currentPage === 'check' ? config.primary_color || defaultConfig.primary_color : config.text_color || defaultConfig.text_color}" onclick="navigateTo('check')">${config.menu_check || defaultConfig.menu_check}</button>
                <button id="menu-students" class="px-2 sm:px-4 py-2 rounded hover:bg-gray-100 transition-colors ${currentPage === 'students' ? 'font-semibold' : ''}" style="color: ${currentPage === 'students' ? config.primary_color || defaultConfig.primary_color : config.text_color || defaultConfig.text_color}" onclick="navigateTo('students')">${config.menu_students || defaultConfig.menu_students}</button>
                <button id="menu-report" class="px-2 sm:px-4 py-2 rounded hover:bg-gray-100 transition-colors ${currentPage === 'report' ? 'font-semibold' : ''}" style="color: ${currentPage === 'report' ? config.primary_color || defaultConfig.primary_color : config.text_color || defaultConfig.text_color}" onclick="navigateTo('report')">${config.menu_report || defaultConfig.menu_report}</button>
                <button id="menu-settings" class="px-2 sm:px-4 py-2 rounded hover:bg-gray-100 transition-colors ${currentPage === 'settings' ? 'font-semibold' : ''}" style="color: ${currentPage === 'settings' ? config.primary_color || defaultConfig.primary_color : config.text_color || defaultConfig.text_color}" onclick="navigateTo('settings')">${config.menu_settings || defaultConfig.menu_settings}</button>
                <button id="menu-about" class="px-2 sm:px-4 py-2 rounded hover:bg-gray-100 transition-colors ${currentPage === 'about' ? 'font-semibold' : ''}" style="color: ${currentPage === 'about' ? config.primary_color || defaultConfig.primary_color : config.text_color || defaultConfig.text_color}" onclick="navigateTo('about')">${config.menu_about || defaultConfig.menu_about}</button>
              </div>
            </div>
          </nav>
        </header>
      `;
    }

    function attachEventListeners() {
      window.navigateTo = (page) => {
        currentPage = page;
        render();
      };

      window.setAttendance = setAttendance;
      window.markAllPresent = markAllPresent;
      window.exportCSV = exportCSV;
      window.copySummary = copySummary;
      window.openEditModal = openEditModal;
      window.closeEditModal = closeEditModal;
      window.saveStudent = saveStudent;
      window.openAddModal = openAddModal;
      window.closeAddModal = closeAddModal;
      window.addNewStudent = addNewStudent;
      window.confirmDeleteStudent = confirmDeleteStudent;
      window.cancelDelete = cancelDelete;
      window.deleteStudent = deleteStudent;

      window.handleSearch = (event) => {
        searchQuery = event.target.value;
        render();
      };

      window.handleFilterChange = (event) => {
        filterClass = event.target.value;
        render();
      };

      window.handleEditModalClick = (event) => {
        if (event.target.classList.contains('modal-overlay')) {
          closeEditModal();
        }
      };

      window.handleAddModalClick = (event) => {
        if (event.target.classList.contains('modal-overlay')) {
          closeAddModal();
        }
      };
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.surface_color || defaultConfig.surface_color,
              set: (value) => {
                config.surface_color = value;
                window.elementSdk.setConfig({ surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => {
                config.primary_color = value;
                window.elementSdk.setConfig({ primary_color: value });
              }
            },
            {
              get: () => config.secondary_color || defaultConfig.secondary_color,
              set: (value) => {
                config.secondary_color = value;
                window.elementSdk.setConfig({ secondary_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title],
          ['tagline', config.tagline || defaultConfig.tagline],
          ['cta_button', config.cta_button || defaultConfig.cta_button],
          ['menu_check', config.menu_check || defaultConfig.menu_check],
          ['menu_students', config.menu_students || defaultConfig.menu_students],
          ['menu_report', config.menu_report || defaultConfig.menu_report],
          ['menu_settings', config.menu_settings || defaultConfig.menu_settings],
          ['menu_about', config.menu_about || defaultConfig.menu_about]
        ])
      });
    }

    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99d6d9c7d01c3dd4',t:'MTc2Mjk1OTEyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
